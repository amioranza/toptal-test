module "rds_instance" {
  source                       = "cloudposse/rds/aws"
  version                      = "0.40.0"
  namespace                    = "tt"
  stage                        = local.env
  name                         = "app"
  ca_cert_identifier           = "rds-ca-2019"
  allowed_cidr_blocks          = [module.vpc.vpc_cidr_block]
  database_name                = "appdb"
  database_user                = "appuser"
  database_password            = aws_ssm_parameter.ssm-parameters["database_password"].value
  database_port                = 5432
  multi_az                     = false
  storage_type                 = "gp2"
  allocated_storage            = 100
  storage_encrypted            = false
  engine                       = "postgres"
  engine_version               = "13.7"
  major_engine_version         = "13"
  db_parameter_group           = "postgres13"
  instance_class               = "db.t3.micro"
  publicly_accessible          = false
  subnet_ids                   = module.vpc.private_subnets
  vpc_id                       = module.vpc.vpc_id
  auto_minor_version_upgrade   = true
  allow_major_version_upgrade  = false
  apply_immediately            = true
  maintenance_window           = "Mon:03:00-Mon:04:00"
  skip_final_snapshot          = false
  copy_tags_to_snapshot        = true
  backup_retention_period      = 7
  backup_window                = "22:00-03:00"
  performance_insights_enabled = true
}
